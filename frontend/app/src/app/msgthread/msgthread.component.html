<h1>Konverzacija: {{thread.subject}}</h1>
<div *ngIf='block == null'>
    <button *ngIf='thread.active' (click)='archiveThread()'>Arhiviraj konverzaciju</button>
    <button *ngIf='!thread.active' (click)='archiveThread()'>Vrati konverzaciju iz arhive</button>
</div>

<table *ngFor='let m of messages'>
    <ng-container *ngIf='thread.realestate != null'>

        <tr *ngIf='m.from != loggedUser.username && loggedUser.type == 1'>
            <td *ngIf='owner && otherUser != "Agencija"'>{{m.from}}</td>
            <td *ngIf='owner && otherUser == "Agencija"'>Agencija</td>
            <td *ngIf='!owner'>Vlasnik nekretnine</td>
        </tr>

        <tr *ngIf='m.from != loggedUser.username && loggedUser.type == 2'>
            <td *ngIf='owner && (m.from == thread.user1 || m.from == thread.user2)'>{{m.from}}</td>
            <td *ngIf='!owner && (m.from == thread.user1 || m.from == thread.user2) && m.from != "Agencija"'>Vlasnik nekretnine</td>
            <td *ngIf='!owner && m.from == "Agencija"'>Agencija</td>
            <td *ngIf='m.from != thread.user1 && m.from != thread.user2'>{{m.from}} [Agencija]</td>
        </tr>

        <tr *ngIf='m.from == loggedUser.username'>
            <td>Ja</td>
            <td *ngIf='loggedUser.type == 2'>[Agencija]</td>
        </tr>
    </ng-container>

    <ng-container *ngIf='thread.realestate == null'>
        <tr>
            <td>{{m.from}}</td>
        </tr>
    </ng-container>

    <tr>
        <td>({{m.timestamp | date: 'dd. MM. yyyy. u HH.mm' }}):</td>
    </tr>

    <tr>
        <td>{{m.content}}</td>
    </tr>

</table>

<form *ngIf='block == null'>
    <tr>
        <td>Odgovori:</td>
        <td><textarea name='content' [(ngModel)]='content'></textarea></td>
    </tr>

    <tr>
        <td colspan='2'>
            <button (click)='send()'>Pošalji</button>
        </td>
    </tr>

    <button (click)='blockUser()' *ngIf='loggedUser.type == 1 && otherUser != "Agencija"'>Blokiraj korisnika</button>
</form>

<div *ngIf='block != null && block.blocker == loggedUser.username'>
    <p>Nije moguće nastaviti konverzaciju zato što ste blokirali korisnika.</p>
    <button (click)='unblockUser()'>Odblokiraj korisnika</button>
</div>

<p *ngIf='block != null && block.blocked == loggedUser.username'>Nije moguće nastaviti konverzaciju zato što Vas je korisnik
    blokirao.</p>